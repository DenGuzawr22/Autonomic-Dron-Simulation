incarnation: protelis
environment:
  type: OSMEnvironment
variables:
  start: &start [0.381200, 36.86349]
  coordinates: &coordinates [[0.381201, 36.86349],
                             [0.381199, 36.863488],
                             [0.381199, 36.863486],
                             [0.381205, 36.863484],
                             [0.381215, 36.863481],
                             [0.381231, 36.863477],
                             [0.381253, 36.863472],
                             [0.381279, 36.863465],
                             [0.38131, 36.863457],
                             [0.381346, 36.863448],
                             [0.381384, 36.863438],
                             [0.381423, 36.863428],
                             [0.381459, 36.863419],
                             [0.381488, 36.863411],
                             [0.381509, 36.863404],
                             [0.38152, 36.863399],
                             [0.381524, 36.863395],
                             [0.381519, 36.863393],
                             [0.381515, 36.863393],
                             [0.381518, 36.863391],
                             [0.381527, 36.863388],
                             [0.38154, 36.863383],
                             [0.381548, 36.86338],
                             [0.381554, 36.863377],
                             [0.381555, 36.863374],
                             [0.381556, 36.863372],
                             [0.381562, 36.863368],
                             [0.381572, 36.86336],
                             [0.381586, 36.863348],
                             [0.381605, 36.863332],
                             [0.381628, 36.863314],
                             [0.381653, 36.863295],
                             [0.381682, 36.863273],
                             [0.381713, 36.86325],
                             [0.381747, 36.863225],
                             [0.381783, 36.8632],
                             [0.381817, 36.863176],
                             [0.381844, 36.863155],
                             [0.381864, 36.863139],
                             [0.381874, 36.863129],
                             [0.381876, 36.863124],
                             [0.381872, 36.863123],
                             [0.381867, 36.863124],
                             [0.381862, 36.863124],
                             [0.381858, 36.863123],
                             [0.381855, 36.863122],
                             [0.381852, 36.86312],
                             [0.381851, 36.863117],
                             [0.381851, 36.863115],
                             [0.381848, 36.863116],
                             [0.381855, 36.863115],
                             [0.381864, 36.86311],
                             [0.381878, 36.863103],
                             [0.38189, 36.863099],
                             [0.381898, 36.863095],
                             [0.381903, 36.863094],
                             [0.381901, 36.863093],
                             [0.381905, 36.863091],
                             [0.381911, 36.863086],
                             [0.381922, 36.863076],
                             [0.381938, 36.863062],
                             [0.38196, 36.863045],
                             [0.381984, 36.863027],
                             [0.382004, 36.863011],
                             [0.382017, 36.863],
                             [0.382023, 36.862994],
                             [0.382023, 36.862992],
                             [0.38202, 36.862992],
                             [0.38202, 36.862993],
                             [0.382026, 36.862988],
                             [0.382033, 36.86298],
                             [0.382045, 36.862969],
                             [0.382059, 36.862954],
                             [0.382077, 36.862937],
                             [0.382097, 36.862917],
                             [0.382117, 36.862899],
                             [0.382135, 36.862882],
                             [0.382147, 36.862871],
                             [0.382153, 36.862865],
                             [0.382153, 36.862864],
                             [0.382151, 36.862863],
                             [0.382154, 36.862862],
                             [0.382155, 36.862861],
                             [0.382159, 36.862858],
                             [0.382164, 36.862852],
                             [0.382173, 36.862845],
                             [0.382184, 36.862835],
                             [0.382197, 36.862824],
                             [0.382211, 36.862811],
                             [0.38222, 36.862803],
                             [0.382225, 36.862798],
                             [0.382228, 36.862796],
                             [0.38223, 36.862793],
                             [0.382235, 36.862788],
                             [0.382243, 36.86278],
                             [0.382253, 36.862769],
                             [0.382262, 36.862758],
                             [0.382268, 36.862752],
                             [0.382272, 36.862747],
                             [0.382274, 36.862745],
                             [0.382276, 36.862743],
                             [0.38228, 36.862738],
                             [0.382288, 36.862729],
                             [0.382301, 36.862715],
                             [0.382315, 36.862698],
                             [0.382326, 36.862685],
                             [0.382332, 36.862677],
                             [0.382335, 36.862673],
                             [0.382337, 36.86267],
                             [0.382341, 36.862665],
                             [0.382346, 36.862659],
                             [0.38235, 36.862654],
                             [0.382351, 36.862651],
                             [0.382353, 36.86265],
                             [0.382355, 36.862648],
                             [0.382357, 36.862643],
                             [0.382363, 36.862633],
                             [0.382373, 36.862618],
                             [0.382386, 36.862597],
                             [0.382403, 36.862571],
                             [0.382422, 36.862542],
                             [0.382438, 36.862517],
                             [0.382451, 36.862495],
                             [0.38246, 36.86248],
                             [0.382464, 36.862471],
                             [0.382465, 36.862467],
                             [0.382464, 36.862464],
                             [0.382465, 36.862461],
                             [0.382469, 36.862454],
                             [0.382476, 36.862442],
                             [0.382485, 36.862428],
                             [0.382493, 36.862416],
                             [0.382497, 36.862409],
                             [0.382499, 36.862405],
                             [0.382498, 36.862404],
                             [0.382503, 36.862397],
                             [0.382511, 36.862387],
                             [0.382523, 36.862371],
                             [0.38254, 36.862351],
                             [0.38256, 36.862327],
                             [0.382584, 36.8623],
                             [0.38261, 36.86227],
                             [0.382639, 36.862238],
                             [0.382668, 36.862204],
                             [0.382695, 36.862173],
                             [0.382717, 36.862148],
                             [0.382733, 36.862127],
                             [0.382743, 36.862112],
                             [0.382747, 36.862104],
                             [0.382749, 36.862099],
                             [0.382747, 36.862097],
                             [0.382744, 36.862096],
                             [0.382746, 36.862094],
                             [0.382752, 36.862087],
                             [0.38276, 36.862077],
                             [0.382773, 36.862063],
                             [0.382787, 36.862048],
                             [0.382798, 36.862035],
                             [0.382806, 36.862026],
                             [0.382809, 36.862021],
                             [0.382809, 36.862018],
                             [0.38281, 36.862016],
                             [0.382812, 36.862014],
                             [0.382817, 36.862012],
                             [0.382825, 36.862009],
                             [0.382836, 36.862006],
                             [0.382843, 36.862004],
                             [0.382848, 36.862003],
                             [0.382849, 36.862004],
                             [0.382852, 36.862009],
                             [0.382858, 36.862017],
                             [0.382867, 36.86203],
                             [0.382877, 36.862044],
                             [0.382884, 36.862056],
                             [0.382888, 36.862063],
                             [0.382891, 36.862067],
                             [0.382891, 36.862066],
                             [0.382895, 36.862067],
                             [0.382898, 36.862069],
                             [0.382903, 36.862072],
                             [0.382913, 36.862076],
                             [0.382927, 36.862084],
                             [0.382942, 36.862091],
                             [0.382952, 36.862097],
                             [0.382957, 36.8621],
                             [0.382957, 36.862099],
                             [0.382958, 36.862094],
                             [0.382959, 36.862086],
                             [0.38296, 36.862076],
                             [0.382962, 36.862069],
                             [0.382962, 36.862064],
                             [0.382961, 36.862061],
                             [0.382957, 36.862061],
                             [0.382956, 36.862062],
                             [0.382956, 36.862064],
                             [0.382954, 36.862063],
                             [0.382951, 36.862065],
                             [0.382948, 36.862069],
                             [0.382943, 36.862073],
                             [0.382938, 36.862077],
                             [0.382931, 36.862083],
                             [0.382923, 36.862089],
                             [0.382914, 36.862097],
                             [0.382903, 36.862105],
                             [0.382892, 36.862114],
                             [0.382879, 36.862125],
                             [0.382866, 36.862136],
                             [0.382851, 36.862149],
                             [0.382834, 36.862162],
                             [0.382817, 36.862176],
                             [0.382797, 36.862192],
                             [0.382777, 36.862208],
                             [0.382756, 36.862225],
                             [0.382734, 36.862243],
                             [0.38271, 36.862262],
                             [0.382686, 36.862282],
                             [0.382661, 36.862303],
                             [0.382635, 36.862324],
                             [0.382607, 36.862347],
                             [0.382578, 36.86237],
                             [0.382548, 36.862395],
                             [0.382516, 36.86242],
                             [0.382484, 36.862446],
                             [0.38245, 36.862474],
                             [0.382415, 36.862502],
                             [0.382381, 36.86253],
                             [0.382345, 36.862559],
                             [0.38231, 36.862587],
                             [0.382276, 36.862616],
                             [0.38224, 36.862645],
                             [0.382206, 36.862672],
                             [0.382172, 36.8627],
                             [0.382138, 36.862728],
                             [0.382104, 36.862755],
                             [0.38207, 36.862782],
                             [0.382036, 36.862809],
                             [0.382002, 36.862838],
                             [0.381967, 36.862866],
                             [0.381935, 36.862893],
                             [0.3819, 36.862921],
                             [0.381867, 36.862948],
                             [0.381833, 36.862976],
                             [0.381799, 36.863004],
                             [0.381765, 36.863031],
                             [0.38173, 36.863059],
                             [0.381697, 36.863087],
                             [0.381663, 36.863114],
                             [0.381629, 36.863142],
                             [0.381595, 36.86317],
                             [0.381562, 36.863197],
                             [0.381527, 36.863225],
                             [0.381495, 36.863251],
                             [0.381461, 36.863278],
                             [0.38143, 36.863303],
                             [0.381401, 36.863327],
                             [0.381374, 36.863349],
                             [0.381349, 36.863369],
                             [0.381327, 36.863388],
                             [0.381305, 36.863405],
                             [0.381286, 36.86342],
                             [0.381269, 36.863434],
                             [0.381254, 36.863447],
                             [0.38124, 36.863458],
                             [0.381229, 36.863466],
                             [0.381222, 36.863473],
                             [0.381216, 36.863477],
                             [0.381212, 36.863481],
                             [0.381209, 36.863483],
                             [0.381207, 36.863485],
                             [0.381205, 36.863487],
                             [0.381209, 36.863486],
                             [0.381216, 36.863486],
                             [0.381222, 36.863485],
                             [0.381228, 36.863485],
                             [0.381231, 36.863484],
                             [0.381231, 36.863486],
                             [0.381232, 36.863479],
                             [0.381231, 36.86347],
                             [0.381231, 36.863462],
                             [0.38123, 36.863455],
                             [0.38123, 36.863451],
                             [0.38123, 36.86345],
                             [0.38123, 36.86346],
                             [0.38123, 36.863464],
                             [0.38123, 36.863469],
                             [0.381227, 36.86347],
                             [0.381224, 36.863469],
                             [0.381222, 36.86347],
                             [0.381219, 36.86347],
                             [0.38122, 36.863472]]

deployments:
  - type: SpecificPositions # only for path demonstration
    parameters: *coordinates
  - type: SpecificPositions
    parameters: [*start]
    contents:
      - molecule: drone
        concentration: true
      - molecule: target
        concentration: [0.381201, 36.86349]
      - molecule: targets
        concentration: *coordinates #[[-1, -1], [-1, 0], [0, 1], [1, 1], [1, 0], [1, -1], [0, -1]]
      - molecule: i
        concentration: 1
    programs:
      - time-distribution: 100
        program: >
          import java.lang.Math.abs
          let epsilon = 0.000002
          let x = self.getCoordinates().get(0)
          let y = self.getCoordinates().get(1)
          let tx = env.get("target").get(0)
          let ty = env.get("target").get(1)
          
          if(abs(x - tx) + abs(y-ty) > epsilon){
            1 // move
          }else{
           if(env.get("i") < env.get("targets").size()){
              let newTarget = env.get("targets").get(env.get("i"))
              env.put("target", newTarget)
              env.put("i", env.get("i") + 1)
              0 // change target
            }else{
              2 // finish
            }
          }
      - type: Event
        time-distribution: 1
        actions: { type: CustomTargetMapWalker, parameters: ["target"] }
  - type: SpecificPositions # only for path demonstration
    contents:
      - molecule: path
        concentration: true
    parameters: [[0.381851, 36.863116],
                 [0.381861, 36.863111],
                 [0.381882, 36.863102],
                 [0.381897, 36.863096],
                 [0.381901, 36.863094],
                 [0.381904, 36.863091],
                 [0.381913, 36.863084],
                 [0.381934, 36.863066],
                 [0.381966, 36.86304],
                 [0.38202, 36.862998],
                 [0.382024, 36.862991],
                 [0.382019, 36.862993],
                 [0.382025, 36.862989],
                 [0.382036, 36.862978],
                 [0.382055, 36.862958],
                 [0.382082, 36.862932],
                 [0.382113, 36.862903],
                 [0.382139, 36.862878],
                 [0.382152, 36.862866],
                 [0.382152, 36.862865],
                 [0.382153, 36.862861],
                 [0.382156, 36.862861],
                 [0.382163, 36.862854],
                 [0.382175, 36.862843],
                 [0.382194, 36.862827],
                 [0.382214, 36.862809],
                 [0.382225, 36.862799],
                 [0.382226, 36.862796],
                 [0.382233, 36.86279],
                 [0.382245, 36.862777],
                 [0.38226, 36.86276],
                 [0.38227, 36.86275],
                 [0.382273, 36.862745],
                 [0.382277, 36.862742],
                 [0.382286, 36.862731],
                 [0.382304, 36.86271],
                 [0.382323, 36.862688],
                 [0.382333, 36.862676],
                 [0.382336, 36.862671],
                 [0.382343, 36.862663],
                 [0.382349, 36.862655],
                 [0.38235, 36.862652],
                 [0.382354, 36.862648],
                 [0.382359, 36.862641],
                 [0.38237, 36.862623],
                 [0.38239, 36.862591],
                 [0.382417, 36.862549],
                 [0.382442, 36.86251],
                 [0.382458, 36.862483],
                 [0.382464, 36.86247],
                 [0.382465, 36.862464],
                 [0.382466, 36.86246],
                 [0.382474, 36.862446],
                 [0.382487, 36.862425],
                 [0.382496, 36.86241],
                 [0.382499, 36.862404],
                 [0.382502, 36.862399],
                 [0.382514, 36.862384],
                 [0.382535, 36.862356],
                 [0.382653, 36.862221],
                 [0.382695, 36.862173],
                 [0.382726, 36.862137],
                 [0.382743, 36.862112],
                 [0.382748, 36.862101],
                 [0.382747, 36.862097],
                 [0.382745, 36.862095],
                 [0.382752, 36.862087],
                 [0.382766, 36.862071],
                 [0.382787, 36.862048],
                 [0.382803, 36.86203],
                 [0.382809, 36.862021],
                 [0.382808, 36.862017],
                 [0.382812, 36.862014],
                 [0.382821, 36.86201],
                 [0.382836, 36.862006],
                 [0.382846, 36.862003],
                 [0.382849, 36.862004],
                 [0.382855, 36.862012],
                 [0.382867, 36.862029],
                 [0.382881, 36.862051],
                 [0.382888, 36.862063],
                 [0.382889, 36.862066],
                 [0.382895, 36.862067],
                 [0.3829, 36.86207],
                 [0.382913, 36.862076],
                 [0.382935, 36.862087],
                 [0.382952, 36.862097],
                 [0.382959, 36.8621],
                 [0.382958, 36.862094],
                 [0.38296, 36.862081],
                 [0.382962, 36.862069],
                 [0.382962, 36.862062],
                 [0.382957, 36.862061],
                 [0.382955, 36.862063]]


